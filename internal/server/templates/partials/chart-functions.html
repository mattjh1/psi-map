{{define "chart-functions"}}
function initializeCharts() {
    console.log('initializeCharts called');
    
    if (typeof Chart === 'undefined') {
        console.warn('Chart.js not loaded yet, retrying...');
        setTimeout(initializeCharts, 100);
        return;
    }
    
    console.log('Chart.js is available');
    
    try {
        initializeDistributionChart(summaryData);
        console.log('Distribution chart initialized');
    } catch (error) {
        console.error('Error initializing distribution chart:', error);
    }
    
    try {
        initializeAverageScoresChart(summaryData);
        console.log('Average scores chart initialized');
    } catch (error) {
        console.error('Error initializing average scores chart:', error);
    }
}

function initializeDistributionChart(data) {
    console.log('initializeDistributionChart called');
    const ctx = document.getElementById('scoreDistributionChart');
    console.log('Canvas element found:', !!ctx);
    
    if (!ctx) {
        console.error('scoreDistributionChart canvas not found');
        return;
    }
    
    console.log('About to access ScoreDistribution...');
    console.log('ScoreDistribution object:', data.ScoreDistribution);
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Performance', 'Accessibility', 'Best Practices', 'SEO'],
            datasets: [{
                label: 'Good (90-100)',
                data: [
                    data.ScoreDistribution["performance"]?.[0] || 0,
                    data.ScoreDistribution["accessibility"]?.[0] || 0,
                    data.ScoreDistribution["best_practices"]?.[0] || 0,
                    data.ScoreDistribution["seo"]?.[0] || 0
                ],
                backgroundColor: '#0cce6b'
            }, {
                label: 'Needs Improvement (50-89)',
                data: [
                    data.ScoreDistribution["performance"]?.[1] || 0,
                    data.ScoreDistribution["accessibility"]?.[1] || 0,
                    data.ScoreDistribution["best_practices"]?.[1] || 0,
                    data.ScoreDistribution["seo"]?.[1] || 0
                ],
                backgroundColor: '#ffa400'
            }, {
                label: 'Poor (0-49)',
                data: [
                    data.ScoreDistribution["performance"]?.[2] || 0,
                    data.ScoreDistribution["accessibility"]?.[2] || 0,
                    data.ScoreDistribution["best_practices"]?.[2] || 0,
                    data.ScoreDistribution["seo"]?.[2] || 0
                ],
                backgroundColor: '#ff6b6b'
            }]
        },
        options: getChartOptions(true)
    });
}

function initializeAverageScoresChart(data) {
    console.log('initializeAverageScoresChart called');
    console.log('About to access AverageScores...');
    console.log('AverageScores object:', data.AverageScores);
    
    const ctx = document.getElementById('averageScoresChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Performance', 'Accessibility', 'Best Practices', 'SEO'],
            datasets: [{
                data: [
                    data.AverageScores["performance"] || 0,
                    data.AverageScores["accessibility"] || 0,
                    data.AverageScores["best_practices"] || 0,
                    data.AverageScores["seo"] || 0
                ],
                backgroundColor: ['#0cce6b', '#17a2b8', '#ffa400', '#6f42c1'],
                borderWidth: 2,
                borderColor: 'rgba(255,255,255,0.2)'
            }]
        },
        options: getChartOptions(false)
    });
}

function getChartOptions(stacked = false) {
    const baseOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#fff' },
                position: stacked ? 'top' : 'bottom'
            }
        }
    };
    
    if (stacked) {
        baseOptions.scales = {
            x: {
                stacked: true,
                ticks: { color: '#fff' },
                grid: { color: 'rgba(255,255,255,0.1)' }
            },
            y: {
                stacked: true,
                ticks: { color: '#fff' },
                grid: { color: 'rgba(255,255,255,0.1)' }
            }
        };
    }
    
    return baseOptions;
}
{{end}}
